# Project: Unlocking High-Accuracy Motor Imagery Decoding in Stroke EEG

## BR41N.IO Designers Hackathon Project

**Team:** G95 - Umair Arshad

---

## Overview

This project analyses Electroencephalography (EEG) data from stroke patients undergoing a Brain-Computer Interface Functional Electrical Stimulation (BCI-FES) rehabilitation therapy. The primary goals were:

1.  To evaluate and compare different BCI decoding pipelines for classifying Left vs. Right hand motor imagery (MI) in this challenging dataset.
2.  To assess the impact of the BCI-FES therapy on the decodability of MI signals by comparing performance on data recorded before (Pre) and after (Post) the therapy intervention.

## Dataset

The dataset consists of 16-channel EEG recordings from 3 chronic stroke patients. For each patient, data is available from the first ('Pre') and last ('Post') sessions of a 25-session BCI-FES therapy program. Each session includes separate 'Training' and 'Testing' runs where the patient performed cued Left or Right hand motor imagery.

Data details:
*   Source: Derived from the study by Sebasti√°n-Romagosa et al. (provided dataset description).
*   Format: `.mat` files containing EEG data (`y`), trigger channel (`trig`), and sampling rate (`fs` = 256 Hz).
*   Task: Binary classification (Left MI vs Right MI).

## Methodology Explored

A systematic approach was taken to find the optimal decoding pipeline:

1.  **Data Loading & Preprocessing:** Scripts load `.mat` files, extract epochs based on triggers (1s to 8s post-trigger), and optionally apply time-domain whitening.
2.  **Standard Pipeline (CSP+LDA/SVM):** Implemented Common Spatial Patterns for spatial filtering combined with Linear Discriminant Analysis (LDA) and Support Vector Machines (SVM) using log-variance features. Parameters like the number of filters and time windows were optimised.
3.  **Advanced Pipeline (PCA+TVLDA):** Explored Time-Variant LDA combined with Principal Component Analysis (PCA) for spatial filtering, with and without whitening.
4.  **State-of-the-Art (Riemannian Geometry):** Implemented pipelines using spatial covariance matrices as features, projected to the tangent space, and classified using Logistic Regression (LR) and SVM.
5.  **Frequency Optimization:** Tested the impact of filtering data into specific frequency bands (Mu: 8-12Hz, Beta: 13-30Hz) before applying the Riemannian pipeline.

## Key Findings

*   **Optimal Pipeline:** The **Riemannian Geometry pipeline with Logistic Regression**, applied to data filtered to the **Beta band (13-30Hz)** within a 2s-6s window, significantly outperformed all other methods, achieving an average accuracy of **~89.6%**.
*   **Therapy Impact:** Using this optimised pipeline, significant improvements in MI decoding accuracy were observed post-therapy for Patient 2 (+20.0%) and Patient 3 (+20.0%), suggesting the therapy enhanced the neural signals relevant for BCI control. Patient 1 showed a decrease (-7.5%), highlighting patient variability.
*   **Preprocessing:** Time-domain whitening and PCA-based spatial filtering were found to be less effective or even detrimental for this specific dataset and the tested pipelines compared to CSP or the Riemannian approach on Beta-filtered data.
*   **Visual Confirmation:** ERD/ERS analysis, confusion matrices, t-SNE plots, and topographical maps provided visual evidence supporting the quantitative findings, showing clearer neural patterns and feature separability post-therapy for patients P2 and P3.

## Repository Structure

*   `all_processed_data.pkl`: Python pickle file containing the loaded and epoched data (original and whitened). Generated by `phs_1.3_time_whitening.py`.
*   `detailed_results_p2_p3.pkl`: Pickle file with detailed outputs (labels, predictions, features) for P2/P3 from the best pipeline run. Generated by the modified Riemannian script.
*   `phs_1.*.py`: Scripts for initial data loading, epoching, and whitening (Phase 1).
*   `phs_2.*.py`: Scripts implementing and testing the different decoding pipelines (CSP+LDA, CSP+SVM, PCA+TVLDA, Riemannian).
*   `phs_4.*.py`: Scripts for generating visualisations (ERD/ERS, results plots, confusion matrices, t-SNE, topomaps).
*   `*.csv`: CSV files containing accuracy results for different pipeline runs.
*   `*.png`: Generated plot images.

## Setup & Usage

1.  **Dependencies:** Python 3.x, NumPy, SciPy, Scikit-learn, MNE-Python, Matplotlib, Pandas, Seaborn, Statsmodels, PyRiemann.
2.  **Data:** Place the original `.mat` files in the base directory specified within the scripts (e.g., `base_data_dir`).
3.  **Run Phase 1:** Execute `phs_1.3_time_whitening.py` (or `phs_1.4` if whitening isn't needed) to generate `all_processed_data.pkl`.
4.  **Run Pipelines:** Execute the desired Phase 2 scripts (e.g., `phs_2.3a_riemannian.py` for the best pipeline) to generate accuracy results (`.csv`) and the detailed results (`.pkl`).
5.  **Generate Visuals:** Execute the Phase 4 scripts (e.g., `phs_4.1`, `phs_4.2`, `phs_4.3`, `phs_4.4`) to generate the `.png` plots.

## Conclusion

This project identified a high-performance BCI decoding pipeline for challenging stroke patient EEG data and demonstrated its utility in revealing potential therapy-induced neural changes. The findings highlight the importance of advanced signal processing (Riemannian Geometry) and frequency-specific analysis (Beta band) for this application.